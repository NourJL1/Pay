<div class="register-container bg-white p-6 rounded-lg shadow-md max-w-2xl mx-auto">
  <!-- Header -->
  <div class="flex flex-col items-center space-y-4 mb-8">
    <img src="../../../../assets/logo.png" alt="App Logo" (click)="goHome()" 
         class="w-16 h-16 object-contain cursor-pointer hover:opacity-80 transition-opacity">
    <h2 class="text-2xl font-bold text-secondary">Register</h2>
  </div>

  <!-- Step Indicator -->
  <div class="flex justify-between mb-8">
    <span *ngFor="let step of [1,2,3,4,5,6]" 
          [class]="'step-indicator ' + (currentStep === step ? 'active' : '')">
      Step {{step}}
    </span>
  </div>

  <!-- Messages -->
  <div *ngIf="errorMessage" class="mb-4 p-3 bg-red-100 text-red-700 rounded-md">
    {{ errorMessage }}
  </div>
  <div *ngIf="successMessage" class="mb-4 p-3 bg-green-100 text-green-700 rounded-md">
    {{ successMessage }}
  </div>

  <form #form="ngForm" class="space-y-6">
    <!-- Step 1 - Wallet Type -->
    <div *ngIf="currentStep === 1" class="step">
      <h3 class="text-lg font-medium mb-4">Choose Wallet Type:</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div *ngFor="let type of ['CUSTOMER', 'INTERNE', 'MERCHANT']"
             [class]="'wallet-card ' + (CUSTOMER.walletType === type ? 'selected' : '')"
             (click)="CUSTOMER.walletType = type">
          <input type="radio" name="walletType" [value]="type" [(ngModel)]="CUSTOMER.walletType" hidden>
          <h4 class="font-semibold">
            <span *ngIf="type === 'CUSTOMER'">üë§</span>
            <span *ngIf="type === 'INTERNE'">üßë‚Äçüíº</span>
            <span *ngIf="type === 'MERCHANT'">üè¨</span>
            {{ type | titlecase }}
          </h4>
          <p class="text-sm text-gray-600 mt-1">
            {{ type === 'CUSTOMER' ? 'Use your wallet to buy, pay and manage your funds.' : 
               type === 'INTERNE' ? 'Internal use wallet. Track, test, and operate securely.' : 
               'Receive payments, manage sales and grow your business.' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Step 2 - Personal Info -->
    <div *ngIf="currentStep === 2" class="step space-y-4">
      <div class="form-field">
        <label class="form-label">First Name:</label>
        <input class="form-input" [(ngModel)]="CUSTOMER.cusFirstName" name="cusFirstName" type="text" required>
      </div>
      
      <div class="form-field">
        <label class="form-label">Middle Name (Optional):</label>
        <input class="form-input" [(ngModel)]="CUSTOMER.cusMidName" name="cusMidName" type="text">
      </div>
      
      <div class="form-field">
        <label class="form-label">Last Name:</label>
        <input class="form-input" [(ngModel)]="CUSTOMER.cusLastName" name="cusLastName" type="text" required>
      </div>
      
      <div class="form-field">
        <label class="form-label">Username:</label>
        <input class="form-input" [(ngModel)]="CUSTOMER.username" name="username" type="text" required>
      </div>
    </div>

    <!-- Step 3 - Location -->
    <div *ngIf="currentStep === 3" class="step space-y-4">
      <h3 class="text-lg font-medium">Select Your Country and City</h3>
      
      <div class="form-field">
        <label class="form-label">Country:</label>
        <select class="form-input" [(ngModel)]="CUSTOMER.country" name="country" (change)="onCountryChange()">
          <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
        </select>
      </div>
      
      <div class="form-field">
        <label class="form-label">City:</label>
        <select class="form-input" [(ngModel)]="CUSTOMER.city" name="city">
          <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
        </select>
      </div>
    </div>

    <!-- Step 4 - Phone -->
    <div *ngIf="currentStep === 4" class="step">
      <div class="form-field">
        <label class="form-label">Phone Number:</label>
        <ngx-intl-tel-input 
          [cssClass]="'form-input'" 
          [preferredCountries]="preferredCountries"
          [onlyCountries]="[selectedCountry]" 
          [enableAutoCountrySelect]="false" 
          [enablePlaceholder]="true"
          [separateDialCode]="separateDialCode" 
          [searchCountryField]="searchCountryField"
          [formControl]="phoneForm.controls.phone" 
          required>
        </ngx-intl-tel-input>
      </div>
    </div>

    <!-- Step 5 - Email & OTP -->
    <div *ngIf="currentStep === 5" class="step space-y-4">
      <div class="form-field">
        <label class="form-label">Email:</label>
        <div class="flex gap-2">
          <input class="form-input flex-1" [(ngModel)]="CUSTOMER.cusMailAdress" name="cusMailAdress" 
                 type="email" required #email="ngModel" email [disabled]="otpSent">
          <button *ngIf="!otpSent" class="btn primary" type="button" (click)="sendOtp()" [disabled]="email.invalid">
            Send OTP
          </button>
        </div>
        <div *ngIf="email.invalid && email.touched" class="error-message">
          <div *ngIf="email.errors?.['required']">Email is required</div>
          <div *ngIf="email.errors?.['email']">Invalid email format</div>
        </div>
      </div>

      <!-- OTP Section -->
      <div *ngIf="otpSent && !otpVerified" class="form-field">
        <label class="form-label">OTP Code:</label>
        <div class="flex gap-2">
          <input class="form-input flex-1" [(ngModel)]="otpCode" name="code" 
                 type="text" required #otp="ngModel" pattern="[0-9]{6}">
          <button class="btn secondary" type="button" (click)="sendOtp()">Resend</button>
        </div>
        <div *ngIf="otp.invalid && otp.touched" class="error-message">
          <div *ngIf="otp.errors?.['required']">OTP is required</div>
          <div *ngIf="otp.errors?.['pattern']">Must be 6 digits</div>
        </div>
        <button class="btn primary w-full mt-2" type="button" (click)="verifyOtp()" [disabled]="otp.invalid">
          Verify OTP
        </button>
      </div>

      <!-- Password Section -->
      <div *ngIf="otpVerified" class="form-field">
        <label class="form-label">Password:</label>
        <input class="form-input" [(ngModel)]="CUSTOMER.cusMotDePasse" name="password" 
               type="password" required minlength="6" #password="ngModel">
        <div *ngIf="password.invalid && password.touched" class="error-message">
          <div *ngIf="password.errors?.['required']">Password is required</div>
          <div *ngIf="password.errors?.['minlength']">Minimum 6 characters</div>
        </div>
      </div>
    </div>

    <!-- Step 6 - KYC -->
    <div *ngIf="currentStep === 6" class="step space-y-4">
      <div class="form-field">
        <label class="form-label">Identification Type:</label>
        <select class="form-input" [(ngModel)]="CUSTOMER.identificationType" name="idType">
          <option value="CIN">ID Card</option>
          <option value="PASSPORT">Passport</option>
          <option value="CARTE_SEJOUR">Carte S√©jour</option>
        </select>
      </div>
      
      <div class="form-field">
        <label class="form-label">Upload ID Files (recto, verso):</label>
        <input type="file" class="form-input p-2" multiple (change)="onFileSelected($event)" 
               accept=".jpg,.jpeg,.png,.pdf">
      </div>
    </div>
  </form>

  <!-- Navigation Buttons -->
  <div class="flex justify-between mt-8">
    <button class="btn secondary" (click)="goToPreviousStep()" [disabled]="currentStep === 1">
      Back
    </button>
    <button *ngIf="currentStep < 6" class="btn primary" (click)="goToNextStep()">
      Next
    </button>
    <button *ngIf="currentStep === 6" class="btn primary" (click)="onSubmit()">
      Submit
    </button>
  </div>

  <!-- Login Link -->
  <div class="mt-6 text-center text-sm text-gray-600">
    Already have an account? 
    <a href="/login" class="text-primary hover:underline">Login here</a>
  </div>
</div>