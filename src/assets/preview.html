<!DOCTYPE html>
<html>
<head>
  <title>Document Preview</title>
  <style>
    body { 
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    #toolbar {
      padding: 8px;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
      display: flex;
      gap: 8px;
    }
    #content {
      width: 100vw;
      height: calc(100vh - 40px);
      overflow: auto;
      display: flex;
      justify-content: center;
      background: #eee;
    }
    #document-view {
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 100%;
    }
    button {
      padding: 4px 8px;
      cursor: pointer;
    }
  </style>
</head>
<body oncontextmenu="return false">
  <div id="toolbar">
    <button onclick="zoom(0.8)">-</button>
    <span id="zoom-level">100%</span>
    <button onclick="zoom(1.2)">+</button>
    <button onclick="fitToWidth()" style="margin-left: auto">Fit Width</button>
  </div>
  <div id="content">
    <div id="document-view"></div>
  </div>

  <script>
    let scale = 1;
    const docView = document.getElementById('document-view');
    const zoomLevel = document.getElementById('zoom-level');
    const urlParams = new URLSearchParams(window.location.search);
    const fileUrl = urlParams.get('url');
    const fileType = urlParams.get('type');

    // Block keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey || e.key === 'F12') e.preventDefault();
    });

    function loadDocument() {
      if (fileType.includes('pdf')) {
        docView.innerHTML = `<embed src="${fileUrl}" type="${fileType}" width="100%" height="100%">`;
      } 
      else if (fileType.includes('image')) {
        docView.innerHTML = `<img src="${fileUrl}" style="max-width: 100%">`;
        fitToWidth();
      }
      else {
        docView.innerHTML = `
          <div style="padding: 20px; text-align: center">
            <p>Preview not available for ${fileType} files</p>
            <p>Please download to view</p>
          </div>`;
      }
    }

    function zoom(factor) {
      scale *= factor;
      docView.style.transform = `scale(${scale})`;
      docView.style.transformOrigin = 'top left';
      zoomLevel.textContent = `${Math.round(scale * 100)}%`;
    }

    function fitToWidth() {
      if (fileType.includes('image')) {
        const img = docView.querySelector('img');
        if (img) {
          scale = (window.innerWidth - 40) / img.naturalWidth;
          zoom(1); // Reset then apply new scale
        }
      }
    }

    window.addEventListener('load', loadDocument);
    window.addEventListener('resize', fitToWidth);
  </script>
</body>
</html>